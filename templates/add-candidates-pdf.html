{% extends 'base.html' %}
{% load static %}
{% block title %}Dashboard - Cleo{% endblock %}
{% block content %}

<div class="container-xl px-4 mt-4">
    <div class="card mb-4">
      <div class="card-header">Upload Candidate PDFs</div>
      <div class="card-body">
        <form method="POST" enctype="multipart/form-data" id="uploadForm">
          {% csrf_token %}
          <input type="file" id="pdfInput" name="uploaded_pdf" accept="application/pdf" hidden multiple>
          
          <div id="dropzone" class="border border-3 border-dashed rounded text-center py-5 bg-light">
            <p class="text-muted"><i class="fa-solid fa-cloud-arrow-up fa-2xl mb-2"></i><br>
            Drag and drop PDF files here or</p>
            <button type="button" id="selectFilesBtn" class="btn btn-outline-primary">Select Files</button>
          </div>
  
          <div id="uploadedList" class="mt-4"></div>
  
          <button type="submit" class="btn btn-primary mt-3">Upload</button>
        </form>
      </div>
    </div>
  
    <div class="card">
      <div class="card-header">Uploaded Candidates</div>
      <div class="card-body">
        {% if candidates %}
          <ul class="list-group mt-3">
            {% for candidate in candidates %}
              <li class="list-group-item">
                <a href="{{ candidate.uploaded_pdf.url }}" target="_blank">{{ candidate.uploaded_pdf.name }}</a>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted">No files uploaded yet.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const dropzone = document.getElementById('dropzone');
      const fileInput = document.getElementById('pdfInput');
      const selectFilesBtn = document.getElementById('selectFilesBtn');
      const uploadedList = document.getElementById('uploadedList');
    
      let allFiles = [];
    
      selectFilesBtn.addEventListener('click', () => fileInput.click());
    
      fileInput.addEventListener('change', () => {
        const newFiles = Array.from(fileInput.files);
        allFiles = [...allFiles, ...newFiles];
        updateFileList();
      });
    
      dropzone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropzone.classList.add('border-primary', 'bg-white');
        dropzone.classList.remove('bg-light');
      });
    
      dropzone.addEventListener('dragleave', () => {
        dropzone.classList.remove('border-primary', 'bg-white');
        dropzone.classList.add('bg-light');
      });
    
      dropzone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropzone.classList.remove('border-primary', 'bg-white');
        dropzone.classList.add('bg-light');
    
        const droppedFiles = Array.from(e.dataTransfer.files).filter(file => file.type === 'application/pdf');
        allFiles = [...allFiles, ...droppedFiles];
        updateFileList();
      });
    
      function updateFileList() {
        uploadedList.innerHTML = '';
        allFiles.forEach((file, index) => {
          const item = document.createElement('div');
          item.classList.add('d-flex', 'justify-content-between', 'align-items-center', 'border', 'rounded', 'p-2', 'mb-2');
          item.innerHTML = `
            <div>
              <i class="fa-regular fa-file-pdf text-danger me-2"></i>
              ${file.name}
            </div>
            <button class="btn btn-sm btn-outline-danger" data-index="${index}">üóëÔ∏è</button>
          `;
          uploadedList.appendChild(item);
        });
    
        // Skapa ny FileList f√∂r fileInput
        const dataTransfer = new DataTransfer();
        allFiles.forEach(file => dataTransfer.items.add(file));
        fileInput.files = dataTransfer.files;
    
        // L√§gg till ta bort-funktion
        uploadedList.querySelectorAll('button[data-index]').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const index = parseInt(e.currentTarget.dataset.index);
            allFiles.splice(index, 1);
            updateFileList();
          });
        });
      }
    });
    </script>

{% endblock %}